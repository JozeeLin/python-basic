# 第五章 数字

本章的主题是python中的数字。

## 数字简介

数字提供了标量储存和直接访问。它是不可更改类型，也就是说变更数字的值会生成新的对象。

python支持多种数字类型：整型、长整型、布尔型、双精度浮点型、十进制浮点型和复数。

### 如何创建数值对象并用其赋值（数字对象）

```python
anInt = 1
aLong = -9999999999999999
```

### 如何更新数字对象

通过给数字对象重新赋值，你可以更新一个数值对象。这里的更新实际上是生成一个新的数值对象，并得到它的引用。

在python中，变量更像一个指针指向装变量值的盒子。对不可改变类型来说，你无法改变盒子的内容，但可以将指针指向一个新盒子。

### 如何删除数字对象

按照python的法则，你无法真正删除一个数值对象。如果你确实想删除一个数值对象，可以使用del语句进行删除。**如果试图使用一个已经被删除的对象引用，会引发NameError异常**。

## 整型

python有几种整型类型。布尔类型是只有两个值的整型。常规整形是绝大多数现代系统都能识别的整型。

### 布尔型

该类型的取值范围只有两个值，也就是布尔值True和布尔值False。

### 标准整型

python标准整型类型等价于C的(有符号)长整型。

### 长整型

python的长整型类型能表达的数值仅仅与你的机器支持的(虚拟)内存大小有关。

长整型类型是标准整型类型的超集，当你的程序需要使用比标准整型类型更大的整型时，长整型类型就有用武之地了。

> 核心风格：用大写字母‘L’表示长整型。

### 整型和长整型的统一

这两种整型类型正在逐渐统一为一种。也就是说，必要时整型会悄悄自动转换为长整型。

## 双精度浮点型

python中的浮点型类似C语言中的double类型，是双精度浮点型。可以用直接的十进制或科学计数法表示。

每个浮点型占8个字节（64位），其中52位用于表示底，11位用于表示指数，剩下一个位表示符号。这看上去相当完美，然而，实际精度依赖于机器架构和创建python解释器的编译器。

浮点型值通常都有一个小数点和一个可选的后缀e。在e和指数之间可以用正(+)或负(-)表示指数的正负。

## 复数

下面是python语言中有关复数的几个概念：

- 虚数不能单独存在，它们总是和一个值为0.0的实数部分一起构成一个复数
- 复数由实数部分和虚数部分构成
- 表示虚数的语法：real+imagj
- 实数部分和虚数部分都是浮点数
- 虚数部分必须有后缀j或J

### 复数的内建属性

| 属性            | 描述                 |
| --------------- | -------------------- |
| num.real        | 该复数的实部         |
| num.imag        | 该复数的虚部         |
| num.conjugate() | 返回该复数的共轭复数 |

## 操作符

### 混合模式操作符

python使用数字类型强制转换的方法来解决数字类型不一致的问题，也就是说它会强制将一个操作数转换为另一个操作数相同的数据类型。这种操作遵循一下基本规则：**整型转换为浮点型，非复数转换为复数**。在python语言参考中这样描述coerce方法：

- 如果由一个操作数是复数，另一个操作数被转换为复数
- 否则，如果由一个操作数是浮点数，另一个操作数被转换为浮点数
- 否则，如果由一个操作数是长整型，另一个操作数被转换为长整型。
- 否则，两者必然都是普通整型，无须类型转换。

数字类型之间的类型转换是自动进行的。不过在确实需要明确指定对某种数据类型进行特殊类型转换的场合，python提供了coerce内建函数来帮助你实现这种转换。

### 算术操作符

#### 1.除法

- 传统除法：如果是整型除法，进行地板除；如果操作数之一是浮点型，则执行真正的除法
- 真正的除法：除法运算总是返回真实的商，不管操作数是整型还是浮点型。通过from \_\_future\_\_ import division来实现。
- 地板除：使用//操作符来直接实现地板除。返回数字序列中小或等于真正的商的最接近的整数部分的数字。

#### 2.取余

整数取余相当容易理解，浮点型取余就略复杂些。

整型、浮点型和复数的实数部分的取余公式：
$$
x-\lfloor \frac{x}{y} \rfloor × y
$$

#### 3.幂运算

幂运算操作符和一元操作符之间的优先级关系比较特别：幂运算操作符比其左侧操作数的一元操作符优先级低，比其右侧操作数的医院操作符的优先级高，由于这个特性你会在算术操作符表中找到两个**。

```python
3**2
'''9'''
-3**2
'''-9'''
3 ** -2
'''0.1111111111111111'''
```

**结论：从上面的例子看出当一元操作符在幂运算操作符的左边时，它的优先级低于幂运算。反之，则高于幂运算。**

### 位操作符(只适用于整型)

python整型支持标准位运算：取反(~),按位与(&),按位或(|),异或(^),以及左移(<<)和右移(>>)。python这样处理位运算。

- 负数会被当成正数的2进制补码处理
- 左移和右移N位等同于无溢出检查的2的N次幂运算：2**N
- 对长整型来说，位操作符使用一种修改的2进制补码形式，**使得符号位可以无限向左扩展**。

取反运算的优先级与数字单目操作符相同，是所有位操作符中优先级最高的一个。所有操作符按优先级高低列在表中：

| 位操作符   | 功能                                       |
| ---------- | ------------------------------------------ |
| ～num      | 单目运算，对数的每一位取反。结果为-(num+1) |
| num1<<num2 | num1左移num2位                             |
| num1>>num2 | num1右移num2位                             |
| num1&num2  | num1与num2按位与                           |
| num1^num2  | num1异或num2                               |
| num1\|num2 | num1与num2按位或                           |

## 内建函数与工厂函数

### 标准类型函数

cmp、str、type这些函数可以用于所有的标准类型。

### 数字类型函数

python现在拥有一系列针对数字类型的内建函数。一些函数用于数字类型转换，另一些则执行一些常用运算。

#### 转换工厂函数

函数int(),long(),float()和complex()用来将其他数值类型转换为相应的数值类型。

int(),long()在转换字符串时，接受一个进制参数，但如果是数字类型之间的转换，则这个参数不能使用。

bool()函数用于将整型1和0转换为标准的布尔值True和False。

**所谓工厂函数就是指这些内建函数都是类对象，当你调用它们时，实际上是创建了一个类实例。**

| 类（工厂函数）                          | 操作                                                         |
| --------------------------------------- | ------------------------------------------------------------ |
| bool(obj)                               | 返回obj对象的布尔值，也就是obj.\_\_nonzero\_\_()方法的返回值 |
| int(obj,base=10)                        | 返回一个字符串或数值对象的整型表示，类似string.atoi()        |
| long(obj,base=10)                       | 返回一个字符或数据对象的长整型表示，类似string.atol()        |
| float(obj)                              | 返回一个字符串或数据对象的浮点型表示，类似string.atof        |
| complex(str) or complex(real, inag=0.0) | 返回一个字符串的复数表示，或者根据给定的实数(及一个可选的虚数部分)生成一个复数对象 |

#### 功能函数

abs(),coerce(),divmod(),pow(),round()这5个运算内建函数用于数值运算。

abs内建函数返回给定参数的绝对值。如果参数是一个复数，那么就返回math.sqrt(num.real2+num.imag2)

coerce内建函数。用于数据类型转换。它为程序员提供了不依赖python解释器，而是自定义两个数值类型转换的方法。对一种新创建的数值类型来说，这个特性非常有用。**函数coerce仅返回一个包含类型转换完毕的两个数值元素的元组。**

```python
print coerce(1,2)
print coerce(1.3, 134L)
print coerce(1, 134L)
print coerce(1j, 134L)
print coerce(1.23-41j,134L)
'''
(1, 2)
(1.3, 134.0)
(1L, 134L)
(1j, (134+0j))
((1.23-41j), (134+0j))
'''
```

divmod函数把除法和取余运算结合起来，返回一个包含商和余数的元组。对整型来说，它的返回值就是地板除和取余操作的结果。

```python
print divmod(10,3)
print divmod(3,10)
print divmod(10,2.5)
print divmod(2.5,10)
print divmod(2+1j,0.5-1j)
'''
(3, 1)
(0, 3)
(4.0, 0.0)
(0.0, 2.5)
((-0+0j), (2+1j))
#复数的地除//和%运算符已经被剔除了，因此复数的divmod函数也会被剔除
'''
```

pow函数和双星运算都可以进行指数运算，二者区别在于一个是内建函数，另一个是操作符。

```python
print pow(2,5)
print pow(5,2)
print pow(3.141592,2)
print pow(1+1j,3)
print pow(5,2,3) #pow(x,y,z)相当于pow(x,y)%z, 但是pow(x,y,z)性能更好。
'''
32
25
9.86960029446
(-2+2j)
1
'''
```

round函数用于对浮点型进行四舍五入运算。它有一个可选的小数位数参数。默认是返回与第一个参数最接近的整型。第二个参数告诉round函数将结果精确到小数点后指定位数。

```python
print round(3)
print round(3.45)
print round(3.4999999)
print round(3.4999999,1)
print round(3.4899999,2)
print round(-3.5)
print round(-3.4)
print round(-3.49)
print round(-3.49,1)
'''
3.0
3.0
3.0
3.5
3.49
-4.0
-3.0
-3.0
-3.5
'''
```

int(),round(),math.floor()三个函数之间的不同之处：

- 函数int直接截去小数部分(返回值为整型)
- 函数floor得到最接近原数但小于原数的整型(返回值为浮点数)
- 函数round得到最接近原数的整型(返回值为浮点数)

### 仅用于整型的函数

| 函数        | 操作                                                         |
| ----------- | ------------------------------------------------------------ |
| hex(num)    | 将数字转换成十六进制并以字符串形式返回                       |
| oct(num)    | 将数字转换成八进制数并以字符串形式返回                       |
| chr(num)    | 将ASCII值的数字转换成ASCII字符，范围只能是0<=num<=255        |
| ord(chr)    | 接受一个ASCII或Unicode字符(长度为1的字符串)，返回相应的ASCII值或Unicode值 |
| unichr(num) | 接受Unicode码值，返回其对应的Unicode字符。所接受的码值范围依赖于你的python是构造于UCS-2还是UCS-4 |

```python
print hex(255) #将数字转换成十六进制，返回字符串
print oct(255) #将数字转换成八进制，返回字符串
print ord('a') #将字符转换为ASCII数值
print chr(97) #将ASCII值的数字转换为字符
print unichr(97) #接受Unicode码值，返回其对应的Unicode字符
'''
0xff
0377
97
a
a
'''
```

## 其他数据类型

### 布尔型

布尔类型是整型的子类，对应于整型的1和0.下面是布尔类型的主要概念：

- 有两个永不改变的值True、False
- 布尔型是整型的子类，但不能再被继承而生成它的子类
- 没有\_\_nonzero\_\_()方法的对象的默认值是True
- 对于值为0的任何数字或空集在python中的布尔值都是False
- 在数学运算中，Boolean值的True和False分别对应于1和0
- 以前返回整型的大部分标准库函数和内建布尔型函数现在返回布尔型
- True和False现在都不是关键字(2.7版本)

所有python对象都有一个内建的True或False值。

### 十进制浮点型

十进制浮点数称为一个python的特性。主要原因是因为下面的语句经常会让一些编写科学计算或金融应用程序的程序员发狂。

注意：你不能混用十进制浮点数和普通的浮点型。你可以通过字符串或其他十进制数创建十进制浮点数。必须导入decimal模块以便使用Decimal类。

```python
from decimal import Decimal
dec = Decimal(.1) #通过浮点数来创建十进制浮点数会得到精度很大的十进制浮点数
print dec
dec1 = Decimal('.1')
print dec1
'''
0.1000000000000000055511151231257827021181583404541015625
0.1
'''
dec+1.0
'''
TypeError: unsupported operand type(s) for +: 'Decimal' and 'float'
'''
print dec1 + Decimal('1.0')
'''1.1'''
```

## 相关模块

| 模块       | 介绍                                                         |
| ---------- | ------------------------------------------------------------ |
| decimal    | 十进制浮点运算类Decimal                                      |
| array      | 高效数值数组                                                 |
| math/cmath | 标准C库数学运算函数。常规数学运算在match模块，复数运算在cmath模块 |
| operator   | 数字操作符的函数实现。比如tor.sub(m,n)等价于m-n              |
| random     | 多种伪随机数生成器                                           |

### 核心模块：random

当你的程序需要随机数功能时，random模块就能派上用场。该模块包含多个伪随机数发生器，它们均以当前时间戳作为随机数种子。

| randint()   | 两个整型参数，返回二者之间的随机整型                         |
| ----------- | ------------------------------------------------------------ |
| randrange() | 它们接受和range函数一样的参数，随机返回range([start,],stop[,step])结果的一项 |
| uniform()   | 几乎和randint一样，不过它返回的是二者之间的一个浮点数(不包括范围上限) |
| random()    | 类似于uniform,只不过下限恒等于0.0，上限恒等于1.0             |
| choice()    | 随机返回给定序列的一个元素                                   |



